<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Manager - Sports Template Generator</title>
    <style>
        /* Include your existing CSS styles */
        /* Add specific styles for template management */
        
        .template-manager {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .template-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .template-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .template-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .template-preview {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 100px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .template-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .edit-form {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-row > div {
            flex: 1;
        }
        
        textarea.template-editor {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="template-manager">
        <div class="header">
            <h1>Template Manager</h1>
            <p class="subtitle">Manage and edit sports result templates</p>
            <div style="margin: 20px 0;">
                <a href="index.html" class="btn btn-secondary">‚Üê Back to Generator</a>
                <button class="btn btn-primary" onclick="showAddTemplateForm()">Add New Template</button>
            </div>
        </div>
        
        <div id="templateList" class="template-list">
            <!-- Templates will be loaded here -->
        </div>
        
        <div id="editForm" class="edit-form hidden">
            <h3 id="formTitle">Edit Template</h3>
            <form onsubmit="saveTemplate(event)">
                <div class="form-row">
                    <div>
                        <label>Template ID:</label>
                        <input type="text" id="templateId" required>
                    </div>
                    <div>
                        <label>Template Name:</label>
                        <input type="text" id="templateName" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Template Content:</label>
                    <textarea id="templateContent" class="template-editor" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Fields (comma-separated):</label>
                    <input type="text" id="templateFields" placeholder="SPORT, EVENT, ROUND, etc." required>
                </div>
                
                <div class="form-row">
                    <div>
                        <label>Sport:</label>
                        <input type="text" id="templateSport">
                    </div>
                    <div>
                        <label>Event:</label>
                        <input type="text" id="templateEvent">
                    </div>
                    <div>
                        <label>Round Type:</label>
                        <input type="text" id="templateRound">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Save Template</button>
                    <button type="button" class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="deleteTemplate()" id="deleteBtn" style="display: none;">Delete Template</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let templatesData = null;
        let editingTemplateId = null;

        // Load templates data
        async function loadTemplates() {
            try {
                const response = await fetch('data/sports_templates.json');
                templatesData = await response.json();
                displayTemplates();
            } catch (error) {
                console.error('Failed to load templates:', error);
                alert('Failed to load templates');
            }
        }

        // Display templates in cards
        function displayTemplates() {
            const listDiv = document.getElementById('templateList');
            listDiv.innerHTML = '';

            Object.entries(templatesData.templates).forEach(([id, template]) => {
                const card = document.createElement('div');
                card.className = 'template-card';
                
                const mappings = templatesData.round_mappings.filter(m => m.template_id == id);
                const usageInfo = mappings.length > 0 ? 
                    `Used by: ${mappings.map(m => `${m.sport} - ${m.event}`).join(', ')}` : 
                    'Not currently used';

                card.innerHTML = `
                    <h4>Template ${id}</h4>
                    <div class="template-preview">${template.template}</div>
                    <p><strong>Fields:</strong> ${Array.isArray(template.fields) ? template.fields.join(', ') : template.fields}</p>
                    <p><small>${usageInfo}</small></p>
                    <div class="template-actions">
                        <button class="btn btn-primary btn-small" onclick="editTemplate('${id}')">Edit</button>
                        <button class="btn btn-secondary btn-small" onclick="duplicateTemplate('${id}')">Duplicate</button>
                        <button class="btn btn-danger btn-small" onclick="confirmDelete('${id}')">Delete</button>
                    </div>
                `;
                
                listDiv.appendChild(card);
            });
        }

        // Show add template form
        function showAddTemplateForm() {
            editingTemplateId = null;
            document.getElementById('formTitle').textContent = 'Add New Template';
            document.getElementById('deleteBtn').style.display = 'none';
            
            // Clear form
            document.getElementById('templateId').value = '';
            document.getElementById('templateName').value = '';
            document.getElementById('templateContent').value = '';
            document.getElementById('templateFields').value = '';
            document.getElementById('templateSport').value = '';
            document.getElementById('templateEvent').value = '';
            document.getElementById('templateRound').value = '';
            
            document.getElementById('editForm').classList.remove('hidden');
        }

        // Edit existing template
        function editTemplate(templateId) {
            editingTemplateId = templateId;
            const template = templatesData.templates[templateId];
            
            document.getElementById('formTitle').textContent = `Edit Template ${templateId}`;
            document.getElementById('deleteBtn').style.display = 'inline-block';
            
            document.getElementById('templateId').value = templateId;
            document.getElementById('templateContent').value = template.template;
            document.getElementById('templateFields').value = Array.isArray(template.fields) ? 
                template.fields.join(', ') : template.fields;
            
            // Find associated mappings
            const mapping = templatesData.round_mappings.find(m => m.template_id == templateId);
            if (mapping) {
                document.getElementById('templateSport').value = mapping.sport || '';
                document.getElementById('templateEvent').value = mapping.event || '';
                document.getElementById('templateRound').value = mapping.round_type || '';
            }
            
            document.getElementById('editForm').classList.remove('hidden');
        }

        // Save template
        function saveTemplate(event) {
            event.preventDefault();
            
            const templateId = document.getElementById('templateId').value;
            const templateContent = document.getElementById('templateContent').value;
            const templateFields = document.getElementById('templateFields').value.split(',').map(f => f.trim());
            
            // Update templates data
            templatesData.templates[templateId] = {
                template: templateContent,
                fields: templateFields
            };
            
            // Save to localStorage (in a real app, you'd send to server)
            localStorage.setItem('updatedTemplates', JSON.stringify(templatesData));
            
            alert('Template saved! Note: Changes are stored locally. Export data to make permanent.');
            
            displayTemplates();
            cancelEdit();
        }

        // Cancel editing
        function cancelEdit() {
            document.getElementById('editForm').classList.add('hidden');
            editingTemplateId = null;
        }

        // Delete template
        function deleteTemplate() {
            if (editingTemplateId && confirm('Are you sure you want to delete this template?')) {
                delete templatesData.templates[editingTemplateId];
                
                // Remove associated mappings
                templatesData.round_mappings = templatesData.round_mappings.filter(
                    m => m.template_id != editingTemplateId
                );
                
                localStorage.setItem('updatedTemplates', JSON.stringify(templatesData));
                
                alert('Template deleted!');
                displayTemplates();
                cancelEdit();
            }
        }

        // Duplicate template
        function duplicateTemplate(templateId) {
            const template = templatesData.templates[templateId];
            const newId = prompt('Enter new template ID:');
            
            if (newId && !templatesData.templates[newId]) {
                templatesData.templates[newId] = {
                    template: template.template,
                    fields: [...template.fields]
                };
                
                localStorage.setItem('updatedTemplates', JSON.stringify(templatesData));
                displayTemplates();
            }
        }

        // Initialize
        window.addEventListener('load', loadTemplates);
    </script>
</body>
</html>
